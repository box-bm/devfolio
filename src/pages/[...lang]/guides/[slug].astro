---
import GuidesLayout from "@layouts/Guides.astro";
import ContactLinks from "@components/ContactLinks.astro";
import Divider from "@components/Divider.astro";
import MeImage from "@images/me.jpeg";
import { getLangFromUrl, useTranslations } from "@i18n/utils";
import { getCollection } from "astro:content";
import { UiKey } from "@i18n/ui";
import { Image } from "astro:assets";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export async function getStaticPaths() {
  const guides = await getCollection("guides", (guide) => !guide.data.draft);

  return guides.flatMap((guide) => ({
    props: {
      guide,
    },
    params: {
      lang: guide.id.split(".")[1],
      slug: guide.id.split(".")[0],
    },
  }));
}

const { guide } = Astro.props;
const { Content } = await guide.render();
---

<GuidesLayout title={guide.data.title} guide={guide.data.title}>
  <article class="guide-content">
    <p class="caption">
      <strong>{t(UiKey["guides.createdAt"])}</strong>: {
        guide.data.date.toLocaleDateString(lang, { dateStyle: "full" })
      }
    </p>
    <p class="caption">
      <strong>{t(UiKey["guides.updatedAt"])}</strong>: {
        guide.data.updatedDate.toLocaleDateString(lang, { dateStyle: "full" })
      }
    </p>
    <Content />
  </article>
  <Divider />
  <section>
    <Image
      src={MeImage}
      alt="Brandon Manzo profile"
      class="profile-picture"
      loading="lazy"
    />
    <div>
      <h2>{t(UiKey["guides.contact.title"])}</h2>
      <p>{t(UiKey["guides.contact.description"])}</p>
      <ContactLinks />
    </div>
  </section>
</GuidesLayout>

<style is:global>
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-top: 8px;
  }

  pre.astro-code {
    padding: 16px;
    border-radius: 8px;
  }

  pre {
    line-height: 1.3;
  }

  blockquote {
    background-color: var(--neutral-light);
    border-left: 4px solid var(--neutral-medium);
    color: var(--text-secondary);
    margin: 0px;
    padding: 0 12px;
  }

  article {
    max-width: 800px;
    margin: 0 auto;
    padding: 24px;
    font-size: 1rem;
  }

  section {
    display: flex;
    flex-wrap: wrap;
    flex-direction: row;
    align-items: center;
    gap: 20px;
    padding: 60px 20px;
    scroll-margin-top: 60px;
  }

  .tags {
    display: flex;
    flex-direction: row;
    gap: 8px;
    margin-bottom: 16px;
  }

  p.caption {
    margin: 4px 0px !important;
  }
</style>
